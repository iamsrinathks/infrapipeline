apiVersion: v1
kind: ServiceAccount
metadata:
  name: secret-manager-sa

---

apiVersion: v1
kind: Pod
metadata:
  name: secret-manager-pod
spec:
  serviceAccountName: secret-manager-sa
  volumes:
    - name: secret-volume
      csi:
        driver: secrets-store.csi.k8s.io
        volumeAttributes:
          secretProviderClass: "gcp-secret-manager"  # CSI driver class for GCP Secret Manager
  containers:
    - name: secret-manager-container
      image: gcr.io/google.com/cloudsdktool/cloud-sdk:slim  # Google Cloud SDK container image
      command: ["/bin/sh"]
      args: ["-c", "gcloud secrets versions access latest --secret=my-github-pat-secret --project=my-project | echo 'my-github-pat: ' && cat > /secrets/my-github-pat"]
      volumeMounts:
        - name: secret-volume
          mountPath: /secrets




apiVersion: secrets-store.csi.x-k8s.io/v1alpha1
kind: SecretProviderClass
metadata:
  name: gcp-secret-manager  # Choose a name for your SecretProviderClass
spec:
  provider: gcp-secret-manager
